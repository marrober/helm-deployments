apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: prog-layers-app-01-dev-01
  namespace: openshift-gitops
spec:
  generators:
    - clusterDecisionResource:
        configMapRef: ocm-placement-generator
        labelSelector:
          matchLabels:
            cluster.open-cluster-management.io/placement: dev-clusters
  strategy:
    type: RollingSync
    rollingSync:
      steps:
        - matchExpressions:
            - key: name
              operator: In
              values:
                - cluster-1
          maxUpdate: 100%
        - matchExpressions:
            - key: name
              operator: In
              values:
                - cluster-2
          maxUpdate: 100%
  syncPolicy:
    applicationsSync: "create-update"
  template:
    metadata:
      annotations:
        apps.open-cluster-management.io/ocm-managed-cluster: '{{name}}'
        apps.open-cluster-management.io/ocm-managed-cluster-app-namespace: openshift-gitops
        argocd.argoproj.io/skip-reconcile: "true" 
      labels:
        apps.open-cluster-management.io/pull-to-ocm-managed-cluster: "true" 
        new-label: "new"
      name: '{{name}}-prog-layers-app-01-dev-01'
    spec:
      destination:
        namespace: prog-layers-app-01-dev-01
        server: '{{server}}'
      project: prog-layers-app-01
      source:
        repoURL: https://github.com/marrober/helm-deployments.git
        path: app-root/progressive-application-sets/layers-01/deployment/01-dev
        targetRevision: main
      syncPolicy:
        automated: {}